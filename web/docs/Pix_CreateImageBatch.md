# 创建图像批次

**节点名称**: `Pix_CreateBatchImages`

**显示名称**: `Create Image Batch (PixNodes)`

**分类**: `PixNodes`

这是一个功能强大的 ComfyUI 自定义节点，旨在提供极其流畅的图像上传、管理和批处理体验。它允许用户在节点界面直接上传多张图片，进行可视化的排序、筛选，并将其转换为符合 ComfyUI 标准的图像批次（Image Batch）或图像列表。

## 核心功能

1. **可视化管理**: 在节点上直接预览、拖拽排序、删除图片。
2. **双模输出**: 同时输出统一尺寸的图像批次（用于模型推理）和原始尺寸的图像列表（用于后期处理）。
3. **高级交互**: 支持多选、连选、批量拖拽移动以及撤销/重做功能。
4. **智能填充**: 提供多种图像缩放填充算法（Fill, Fit, Stretch）。

## 输入参数说明

| 参数名 | 类型 | 默认值 | 说明 |
|---|---|---|---|
| **batch_width** | INT | 1080 | 图像批次的目标宽度。所有输出到 `image_batch` 的图像都将被调整为此宽度。 |
| **batch_height** | INT | 1080 | 图像批次的目标高度。所有输出到 `image_batch` 的图像都将被调整为此高度。 |
| **method** | 选择 | fill | **图像适应目标尺寸的方式**：<br>• **fill (填充)**: 等比缩放图像以填满目标尺寸，居中裁剪多余部分（无黑边）。<br>• **fit (适应)**: 等比缩放图像以完整显示在目标尺寸内，空白区域填充背景色。<br>• **stretch (拉伸)**: 强制拉伸图像以匹配目标尺寸（可能会变形）。 |
| **bg_color** | STRING | #000000 | **背景颜色**。仅在 `method` 选择为 `fit` 时生效，用于填充留白区域。支持点击色块选择或输入 Hex 色值。 |

## 输出接口说明

| 接口名 | 类型 | 说明 |
|---|---|---|
| **image_batch** | `IMAGE` | **标准化图像批次**。<br>输出一个形状为 `[B, H, W, C]` 的 Tensor。其中 B 为图片数量，H/W 为设置的宽高。<br>所有图片均已根据 `method` 处理为统一尺寸。适合连接到 KSampler 或 VAE Encode。 |
| **image_list** | `IMAGE` | **原始图像列表**。<br>输出一个包含多个 `[1, H, W, C]` Tensor 的列表。<br>每张图片**保留原始尺寸**，不做任何缩放或裁剪。适合用于需要处理原图尺寸的后续节点（如 Image List to Batch）。 |

## UI 交互指南

### 1. 图片上传

- 点击中间巨大的 **+ Add Image** 按钮或右上角的小 **+** 号。
- 在弹出的文件选择框中选择一张或多张图片。
- 上传过程中按钮会被锁定，防止并发冲突。

### 2. 视图切换

- 点击右上角的 **▦ (Grid)** 或 **☰ (List)** 按钮，可以在“网格视图”和“列表视图”之间切换。

### 3. 选择功能 (支持多选)

- **单击**: 选中一张图片（取消其他选择）。
- **Ctrl + 单击** (Mac 为 Cmd): 加选/减选当前图片，保留其他选中项。
- **Shift + 单击**: 连续选中从上一次点击位置到当前位置之间的所有图片。
- **点击空白处**: 取消所有选择。

### 4. 拖拽排序 (高级逻辑)

支持拖拽单个或多个选中的图片来调整顺序。

- **智能插入逻辑**:
    - 将图片拖拽到目标图片的 **左侧 (Grid模式)** 或 **上半部分 (List模式)** -> 插入到目标图片 **之前**。
    - 将图片拖拽到目标图片的 **右侧 (Grid模式)** 或 **下半部分 (List模式)** -> 插入到目标图片 **之后**。
- **拖拽选中项**: 如果你已经选中了多张图，拖拽其中任何一张，所有选中的图片都会一起移动。
- **即时拖拽**: 即使未选中图片，直接按下并拖动也会立即选中该图并开始移动，无需先点击选中。

### 5. 撤销与重做

工具栏最左侧提供了历史记录控制：

- **↩ (Undo)**: 撤销上一步操作（包括上传、删除、移动、修改尺寸/颜色/填充模式）。
- **↪ (Redo)**: 重做被撤销的操作。
- *注：当没有可撤销/重做的步骤时，按钮会变暗且不可点击。*

### 6. 删除图片

- 鼠标悬停在图片上时，右上角会出现红色 **×** 号，点击即可删除。
- 在列表模式下，删除按钮位于每行的最右侧。

## 安装与依赖

本节点为单文件插件，依赖 ComfyUI 原生环境。

- 后端逻辑位于 `create_image_batch.py`。
- 前端交互位于 `create_image_batch.js`（ComfyUI 会自动加载 web 目录下的 js 文件）。
- 确保 `__init__.py` 正确导出了节点类。