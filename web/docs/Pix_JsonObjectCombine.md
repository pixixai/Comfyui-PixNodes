# JSON 对象合并 (PixNodes)

**JSON Object Combine** 是一个功能强大的动态节点，用于将零散的数据流汇聚成结构化的 JSON 对象。它不仅支持普通的键值对赋值，还支持智能识别并“打散”输入的 JSON 对象（类似编程中的 Spread 操作）。

## 核心功能

1. **动态端口生成**：根据你在文本框中输入的名称，自动增减输入节点。
2. **智能解构合并**：
    - 如果输入是一个 **字典 (Dict)** 或 **JSON 字符串**，节点会自动将其内容解构并合并到根对象中（忽略端口名称）。
    - 如果输入是 **普通值** (如数字、字符串、图像等)，则使用端口名称作为 Key，输入值作为 Value。
3. **安全序列化**：自动处理无法直接 JSON 化的对象（如 Tensor），防止报错。

## 参数说明

### 输入 (Inputs)

- **合并键列表 (merge_keys)**:
    - 类型：`STRING` (多行文本)
    - 说明：在此处定义输入端口的名称，每行一个。
    - **技巧**：如果你打算输入一个对象进行合并，这里的名称仅作为占位符（方便你识别），不会出现在最终结果的 Key 中。

### 输出 (Outputs)

- **JSON字符串 (json_str)**:
    - 类型：`STRING`
    - 说明：格式化后的 JSON 字符串，可直接用于发送网络请求或保存为文本。非序列化对象（如 Tensor）会显示为 `<Tensor shape=...>`。
- **JSON对象 (json_object)**:
    - 类型：`JSON` (Dict)
    - 说明：原始的 Python 字典对象，保留了所有数据的原始类型（包括 Tensor），适合传递给其他逻辑节点处理。

## 使用示例

假设你在 **merge_keys** 文本框中输入了以下内容：

```
base_config
seed
custom_value

```

此时节点会生成三个输入端口。

### 场景 1：普通赋值

- **输入**:
    - `base_config` 端口连接整数 `512`
    - `seed` 端口连接整数 `1024`
- **输出**:
    
    ```
    {
      "base_config": 512,
      "seed": 1024
    }
    
    ```
    

### 场景 2：智能合并 (解构)

- **输入**:
    - `base_config` 端口连接了一个字典对象：`{"width": 1024, "height": 1024}`
    - `custom_value` 端口连接字符串 `"test"`
- **输出**:
    
    ```
    {
      "width": 1024,    // 字典被自动解构合并了
      "height": 1024,   // base_config 这个 Key 被忽略了
      "custom_value": "test"
    }
    
    ```
    
    *注意：节点自动检测到 `base_config` 传入的是字典，因此执行了合并操作。*
    

### 场景 3：混合使用与 JSON 字符串

- **输入**:
    - `custom_value` 端口输入字符串 `"{'a': 1, 'b': 2}"` (看起来像 JSON 的字符串)
- **输出**:
    
    ```
    {
      "a": 1,
      "b": 2
    }
    
    ```
    
    *注意：节点会自动尝试解析字符串，如果成功且是字典，也会执行合并。*